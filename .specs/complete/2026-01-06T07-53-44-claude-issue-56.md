# Implementation Plan: Add Lightbox Viewer to Gallery Detail Page

**Issue:** #56
**Created:** 2026-01-06
**Status:** Approved - Ready for Implementation

---

## Overview

This plan addresses the need for a lightbox viewer on the Gallery detail page that properly displays images at appropriate resolutions. Currently, the Gallery detail page uses the full 1600px image but CSS constrains it to 484px max, wasting bandwidth. The 800px medium variant is not used at all.

### Goals

1. Update Gallery detail page to use 800px image instead of 1600px for the main display
2. Implement a lightbox component that displays the full 1600px image when triggered
3. Maintain current Gallery page implementation (300px thumbnails)
4. Provide better user experience for viewing artwork in full detail

### Success Criteria

- âœ… Gallery page continues using 300px thumbnails (no changes)
- âœ… Gallery detail page uses 800px image for main display
- âœ… Lightbox viewer displays 1600px image at full size
- âœ… Lightbox is accessible (keyboard navigation, focus trap, screen reader support)
- âœ… Lightbox works on mobile and desktop
- âœ… All tests pass (compile, lint, format, unit tests)
- âœ… Performance: No unnecessary large images loaded until lightbox is opened

### Complexity

**Medium** - This requires:

- Creating a new reusable Lightbox component (client component with state)
- Following existing patterns (similar to CartDrawer for overlay/modal behavior)
- Writing comprehensive tests (component + integration)
- Ensuring accessibility compliance (WCAG 2.1 AA)
- Updating Gallery detail page to integrate the lightbox

---

## Design Decisions

The following design decisions have been approved by the stakeholder:

### 1. Visual Affordance for Clickable Image

**Decision:** Use **both** zoom icon overlay on hover AND "Click to enlarge" text hint.

**Rationale:**

- Provides clear visual feedback that image is interactive
- Zoom icon is universally recognized symbol for enlargement
- Text hint ensures clarity for users who may not recognize the icon
- Redundant affordances improve accessibility and usability

**Implementation:**

- Hover state: Display zoom icon overlay centered on image with semi-transparent background
- Persistent hint: "Click to enlarge" text below or near image (always visible)
- Both elements use high contrast for visibility

---

### 2. Mobile Pinch-to-Zoom

**Decision:** Use **native browser pinch-to-zoom** on lightbox (no custom implementation).

**Rationale:**

- Zero implementation cost - works out of the box
- Users are already familiar with native behavior
- No additional dependencies or bundle size
- Reliable across all devices and browsers
- Can be enhanced with custom zoom in future PR if user feedback warrants it

**Implementation:**

- Do NOT disable viewport zooming (`user-scalable=yes`)
- Allow browser's default pinch-to-zoom behavior on lightbox image
- No custom touch event handling needed

---

### 3. Lightbox Navigation

**Decision:** **No previous/next navigation buttons** in initial implementation.

**Rationale:**

- Keep scope focused on core lightbox functionality
- Reduces complexity and testing burden
- Can be added as separate enhancement in future PR if needed
- Users can close lightbox and click different artwork if they want to view others

**Implementation:**

- Close methods only: overlay click, close button (X), Escape key
- No arrow buttons or keyboard navigation to adjacent artworks

---

### 4. Component Reusability

**Decision:** Place component at `src/components/ui/ImageLightbox.tsx` for reuse across application.

**Rationale:**

- Will be reused on Shoppe page in future PR
- Generic and reusable pattern for any image viewing scenario
- Follows existing component structure (ui/ directory for reusable components)
- Keeps codebase DRY (Don't Repeat Yourself)

**Future Usage:**

- Gallery detail page (this PR)
- Shoppe product detail page (future PR)
- Potentially Projects or Events pages if image lightbox needed

---

## Technical Approach

### Architectural Decisions

#### 1. Component Design Pattern

**Decision:** Create a reusable `ImageLightbox` component following the same pattern as `CartDrawer`.

**Rationale:**

- The `CartDrawer` component already implements best practices for modals: overlay, focus trap, keyboard handling, body scroll lock
- Reusing this proven pattern ensures consistency and reliability
- Follows **Single Responsibility Principle**: The lightbox handles only image viewing concerns

**SOLID Application:**

- **Single Responsibility:** `ImageLightbox` component handles only the lightbox UI/UX
- **Open/Closed:** Component accepts props for extensibility without modification
- **Dependency Inversion:** Depends on abstract props interface, not concrete implementations

#### 2. Image Resolution Strategy

**Current State:**

- `image_thumbnail_url`: 300px (used on Gallery page âœ…)
- `image_large_url`: 800px (not used âŒ)
- `image_url`: 1600px (currently used on detail page but constrained to ~484px âŒ)

**Target State:**

- Gallery page: 300px thumbnails (no change)
- Gallery detail page: 800px for main display
- Lightbox: 1600px for full-size viewing

**Rationale:**

- Reduces initial page load bandwidth (800px vs 1600px)
- Loads 1600px image only when user explicitly opens lightbox
- Better performance without sacrificing user experience

#### 3. Lightbox Interaction Design

**Trigger:** Click on the 800px image in Gallery detail page (with zoom icon overlay and "Click to enlarge" text hint)

**Display:** Full-screen overlay with 1600px image centered

**Close Methods:**

- Click overlay/backdrop
- Click close button (X)
- Press Escape key

**Zoom Behavior:**

- Native browser pinch-to-zoom enabled on mobile (no custom implementation)
- Users can zoom and pan using standard browser gestures

**Accessibility:**

- Focus trap within lightbox
- Keyboard navigation (Tab, Shift+Tab, Escape)
- ARIA attributes (role="dialog", aria-modal, aria-labelledby)
- Screen reader announcements
- Focus restoration to trigger element on close

#### 4. Component Location

**Path:** `src/components/ui/ImageLightbox.tsx`
**Test Path:** `__tests__/components/ui/ImageLightbox.test.tsx`

**Rationale:**

- Placed in `src/components/ui/` alongside other reusable UI components (Button, Card, Grid)
- Generic and reusable across the application
- **Confirmed future usage:** Will be reused on Shoppe product detail page in future PR
- Could also be used for Projects or Events pages if image viewing needed

### Potential Risks and Mitigation

| Risk                         | Mitigation                                                                               |
| ---------------------------- | ---------------------------------------------------------------------------------------- |
| **Large image load time**    | Show loading spinner while 1600px image loads; use Next.js Image component with priority |
| **Mobile performance**       | Use responsive image sizing; test on mobile devices                                      |
| **Accessibility violations** | Follow WCAG 2.1 AA guidelines; test with keyboard and screen reader                      |
| **Browser compatibility**    | Test on modern browsers (Chrome, Firefox, Safari, Edge); use standard CSS/JS             |
| **Z-index conflicts**        | Use z-index above other components (z-50 for lightbox vs z-40 for overlay)               |

---

## Implementation Steps

### Step 1: Create Branch

**Action:** Create feature branch for issue #56

```bash
git checkout -b issue-56
```

**SOLID Principle:** N/A (setup step)

---

### Step 2: Create ImageLightbox Component Test File (TDD Red Phase)

**Action:** Create comprehensive test suite for `ImageLightbox` component BEFORE implementation.

**File:** `__tests__/components/ui/ImageLightbox.test.tsx`

**Test Cases to Write:**

1. **Rendering Tests**
    - Should not render when `isOpen={false}`
    - Should render overlay and lightbox when `isOpen={true}`
    - Should display image with correct src and alt text
    - Should display close button

2. **Interaction Tests**
    - Should call `onClose` when overlay is clicked
    - Should call `onClose` when close button is clicked
    - Should call `onClose` when Escape key is pressed
    - Should NOT call `onClose` when clicking on the image itself

3. **Accessibility Tests**
    - Should have `role="dialog"` and `aria-modal="true"`
    - Should have `aria-labelledby` pointing to image title
    - Should focus close button when lightbox opens
    - Should trap focus within lightbox (Tab navigation)
    - Should prevent body scroll when open
    - Should restore body scroll when closed

4. **Keyboard Navigation Tests**
    - Should handle Tab key (forward focus)
    - Should handle Shift+Tab key (backward focus)
    - Should handle Escape key (close)

**Expected Outcome:** All tests fail (Red phase) because component doesn't exist yet.

**Dependencies:** None

**Verification:**

```bash
tsc --noEmit
npx eslint __tests__/components/ui/ImageLightbox.test.tsx --fix
npx prettier --write __tests__/components/ui/ImageLightbox.test.tsx
npx vitest related run __tests__/components/ui/ImageLightbox.test.tsx
```

**SOLID Application:**

- **Single Responsibility:** Each test case tests one specific behavior
- **Open/Closed:** Test suite can be extended with new test cases without modifying existing ones

---

### Step 3: Implement ImageLightbox Component (TDD Green Phase)

**Action:** Create the `ImageLightbox` component to make tests pass.

**File:** `src/components/ui/ImageLightbox.tsx`

**Requirements:**

1. **Props Interface:**

    ```typescript
    interface ImageLightboxProps {
        isOpen: boolean;
        onClose: () => void;
        imageSrc: string;
        imageAlt: string;
        imageTitle?: string;
    }
    ```

2. **Features:**
    - Render overlay (dark backdrop) with click-to-close
    - Render lightbox dialog with close button
    - Display full-size image using Next.js `Image` component
    - Handle Escape key to close
    - Implement focus trap
    - Prevent body scroll when open
    - Restore focus to trigger element on close

3. **Styling:**
    - Overlay: `fixed inset-0 bg-black/80 z-40` (darker than CartDrawer for image viewing)
    - Lightbox: `fixed inset-0 z-50 flex items-center justify-center p-4`
    - Close button: positioned top-right, white text on dark background
    - Image: centered, max width/height with object-contain

4. **Accessibility:**
    - Use `role="dialog"`, `aria-modal="true"`, `aria-labelledby`
    - Focus close button on mount
    - Trap focus within lightbox
    - Announce dialog opening to screen readers

**Expected Outcome:** All tests pass (Green phase).

**Dependencies:** Step 2 (tests must be written first)

**Verification:**

```bash
tsc --noEmit
npx eslint src/components/ui/ImageLightbox.tsx --fix
npx prettier --write src/components/ui/ImageLightbox.tsx
npx vitest related run src/components/ui/ImageLightbox.tsx
```

**SOLID Application:**

- **Single Responsibility:** Component handles only lightbox UI/UX, no business logic
- **Open/Closed:** Can be extended with additional props (e.g., navigation buttons) without modifying core logic
- **Dependency Inversion:** Depends on abstract `ImageLightboxProps` interface

---

### Step 4: Refactor ImageLightbox Component (TDD Refactor Phase)

**Action:** Review implementation for code quality, extract reusable hooks or utilities if needed.

**Refactoring Opportunities:**

1. **Extract custom hooks:**
    - `useFocusTrap`: Could be extracted if focus trap logic is complex
    - `useBodyScrollLock`: Could be extracted if body scroll logic is reused
    - **Decision:** Keep inline initially; extract only if pattern is reused elsewhere (YAGNI principle)

2. **Extract common utilities:**
    - If overlay/backdrop logic is duplicated with `CartDrawer`, consider extracting `Overlay` component
    - **Decision:** Keep separate initially; refactor only if third component needs overlay

3. **Code cleanup:**
    - Ensure no magic numbers (use named constants)
    - Ensure proper TypeScript types (no `any`)
    - Ensure consistent naming conventions

**Expected Outcome:** Tests still pass, code is cleaner and more maintainable.

**Dependencies:** Step 3 (implementation must pass tests first)

**Verification:**

```bash
tsc --noEmit
npx eslint src/components/ui/ImageLightbox.tsx --fix
npx prettier --write src/components/ui/ImageLightbox.tsx
npx vitest related run src/components/ui/ImageLightbox.tsx
```

**SOLID Application:**

- **Single Responsibility:** Ensure each function/hook has one clear purpose
- **Don't Repeat Yourself (DRY):** Extract common patterns only when truly reused

---

### Step 5: Update Gallery Detail Page Test (TDD Red Phase)

**Action:** Update tests for Gallery detail page to verify lightbox integration.

**File:** `__tests__/app/gallery/[slug]/page.test.tsx` (create if doesn't exist)

**Test Cases to Add:**

1. **Image Display Tests**
    - Should display 800px image (`image_large_url`) in main view
    - Should NOT display 1600px image (`image_url`) in main view
    - Should make image clickable (cursor-pointer class)

2. **Visual Affordance Tests**
    - Should display "Click to enlarge" text hint (always visible)
    - Should show zoom icon overlay on hover (desktop only)
    - Should have proper ARIA attributes for clickable image

3. **Lightbox Integration Tests**
    - Should open lightbox when main image is clicked
    - Should open lightbox when Enter key pressed on focused image
    - Should display 1600px image in lightbox
    - Should close lightbox when overlay is clicked
    - Should pass correct alt text and title to lightbox

**Expected Outcome:** Tests fail (Red phase) because Gallery detail page not updated yet.

**Dependencies:** Step 4 (ImageLightbox component must exist)

**Verification:**

```bash
tsc --noEmit
npx eslint __tests__/app/gallery/[slug]/page.test.tsx --fix
npx prettier --write __tests__/app/gallery/[slug]/page.test.tsx
npx vitest related run __tests__/app/gallery/[slug]/page.test.tsx
```

**SOLID Application:**

- **Single Responsibility:** Each test validates one aspect of the page behavior

---

### Step 6: Update Gallery Detail Page (TDD Green Phase)

**Action:** Modify Gallery detail page to use 800px image and integrate lightbox.

**File:** `src/app/gallery/[slug]/page.tsx`

**Changes:**

1. **Add Client Component Wrapper:**
    - Extract image display logic into a client component (`GalleryDetailClient.tsx`)
    - Rationale: Server components can't have state or event handlers; lightbox needs state

2. **Update Image Display:**
    - Change from `artwork.image_large_url || artwork.image_url` to just `artwork.image_large_url` (800px)
    - Add click handler to open lightbox
    - Add cursor-pointer class to indicate clickability
    - **Add visual affordances (as per approved design decisions):**
        - Zoom icon overlay on hover: Centered magnifying glass icon with semi-transparent background
        - "Click to enlarge" text hint: Persistent text below or near image, always visible
        - Both elements use high contrast for visibility

3. **Integrate Lightbox:**
    - Import `ImageLightbox` component
    - Add state: `const [lightboxOpen, setLightboxOpen] = useState(false)`
    - Render lightbox with 1600px image: `<ImageLightbox isOpen={lightboxOpen} onClose={() => setLightboxOpen(false)} imageSrc={artwork.image_url} imageAlt={artwork.alt_text || artwork.title} imageTitle={artwork.title} />`

4. **Preserve Server-Side Rendering:**
    - Keep metadata generation and data fetching in server component
    - Pass artwork data as props to client component

**File Structure:**

```
src/app/gallery/[slug]/
â”œâ”€â”€ page.tsx (Server Component - data fetching, metadata)
â””â”€â”€ GalleryDetailClient.tsx (Client Component - image display, lightbox)
```

**Expected Outcome:** All tests pass (Green phase).

**Dependencies:** Step 5 (tests must be written first)

**Verification:**

```bash
tsc --noEmit
npx eslint src/app/gallery/[slug]/page.tsx src/app/gallery/[slug]/GalleryDetailClient.tsx --fix
npx prettier --write src/app/gallery/[slug]/page.tsx src/app/gallery/[slug]/GalleryDetailClient.tsx
npx vitest related run src/app/gallery/[slug]/page.tsx src/app/gallery/[slug]/GalleryDetailClient.tsx
```

**SOLID Application:**

- **Single Responsibility:** Server component handles data/metadata, client component handles UI/interaction
- **Open/Closed:** Client component is open for extension (e.g., add navigation between artworks)
- **Dependency Inversion:** Client component depends on abstract `Artwork` type, not concrete database schema

---

### Step 7: Refactor Gallery Detail Page (TDD Refactor Phase)

**Action:** Review page implementation for code quality and maintainability.

**Refactoring Opportunities:**

1. **Extract image fallback logic:**
    - If multiple fallback checks exist, extract into helper function
    - Example: `getArtworkImageUrl(artwork, 'large')` utility

2. **Improve visual affordance:**
    - Verify zoom icon overlay appears correctly on hover
    - Verify "Click to enlarge" text hint is clearly visible and properly styled
    - Ensure consistent styling with rest of site (colors, fonts, spacing)
    - Test hover interactions across different browsers

3. **Code cleanup:**
    - Ensure proper prop drilling vs context (if needed)
    - Ensure consistent styling with rest of site

**Expected Outcome:** Tests still pass, code is more maintainable and user-friendly.

**Dependencies:** Step 6 (implementation must pass tests first)

**Verification:**

```bash
tsc --noEmit
npx eslint src/app/gallery/[slug]/*.tsx --fix
npx prettier --write src/app/gallery/[slug]/*.tsx
npx vitest related run src/app/gallery/[slug]/*.tsx
```

**SOLID Application:**

- **Single Responsibility:** Each helper function has one clear purpose
- **Don't Repeat Yourself (DRY):** Extract common image URL logic if pattern repeats

---

### Step 8: Manual Testing and Accessibility Audit

**Action:** Perform manual testing across devices and accessibility audit.

**Manual Testing Checklist:**

1. **Desktop Testing:**
    - [ ] Gallery page: 300px thumbnails display correctly
    - [ ] Gallery detail page: 800px image displays correctly
    - [ ] **Visual affordances:** Zoom icon overlay appears on hover
    - [ ] **Visual affordances:** "Click to enlarge" text hint is visible and readable
    - [ ] Click 800px image: lightbox opens with 1600px image
    - [ ] Click overlay: lightbox closes
    - [ ] Click close button: lightbox closes
    - [ ] Press Escape: lightbox closes
    - [ ] Tab key: focus stays trapped in lightbox
    - [ ] Body scroll: disabled when lightbox open, restored when closed

2. **Mobile Testing:**
    - [ ] Gallery page: responsive layout works
    - [ ] Gallery detail page: 800px image fits screen
    - [ ] **Visual affordances:** "Click to enlarge" text visible on mobile (zoom icon may not apply without hover)
    - [ ] Lightbox: displays full 1600px image
    - [ ] **Native pinch-to-zoom:** Browser's default pinch-to-zoom works on lightbox image
    - [ ] **Native pinch-to-zoom:** Can zoom in and pan around image smoothly
    - [ ] Lightbox: close button accessible and tappable on small screens
    - [ ] Lightbox: overlay tap closes lightbox

3. **Accessibility Testing:**
    - [ ] Keyboard-only navigation: can open/close lightbox without mouse
    - [ ] Screen reader: announces lightbox opening/closing
    - [ ] Focus management: focus returns to trigger element on close
    - [ ] Color contrast: close button meets WCAG AA standards
    - [ ] ARIA attributes: properly set and valid

4. **Performance Testing:**
    - [ ] Network throttling: 800px image loads quickly on slow connections
    - [ ] 1600px image: only loads when lightbox opened
    - [ ] No layout shift when opening lightbox

**Browser Compatibility:**

- Chrome (latest)
- Firefox (latest)
- Safari (latest)
- Edge (latest)

**Expected Outcome:** All manual tests pass, no accessibility violations.

**Dependencies:** Step 7 (implementation must be complete)

**Verification:** Manual testing (no automated commands)

**SOLID Application:**

- **Testing Principle:** Comprehensive testing ensures quality and maintainability

---

### Step 9: Update Documentation (If Needed)

**Action:** Update documentation to reflect new lightbox feature.

**Files to Review:**

1. **CLAUDE.md:** No changes needed (implementation details only)
2. **README.md:** Consider adding screenshot or mention of lightbox feature
3. **Component Documentation:** Add JSDoc comments to `ImageLightbox` component

**Expected Outcome:** Documentation is up-to-date and helpful.

**Dependencies:** Step 8 (implementation must be tested)

**Verification:**

```bash
npx prettier --write *.md src/**/*.tsx
```

**SOLID Application:**

- **Documentation Principle:** Clear documentation supports maintainability

---

### Step 10: Request Human Review

**Action:** Request comprehensive review of all changes before creating PR.

**Review Checklist:**

- [ ] All tests pass (compile, lint, format, unit tests)
- [ ] Manual testing completed successfully
- [ ] Accessibility audit passed
- [ ] Code follows project conventions
- [ ] No console errors or warnings
- [ ] Performance metrics acceptable
- [ ] Documentation updated

**Expected Outcome:** Human approves changes or requests revisions.

**Dependencies:** Steps 1-9 (all implementation complete)

**Verification:** Human review (no automated commands)

---

### Step 11: Create Pull Request

**Action:** Create PR for issue #56.

```bash
# Ensure all changes are committed
git add .
git commit -m "Add lightbox viewer to Gallery detail page

- Created ImageLightbox component with accessibility features
- Updated Gallery detail page to use 800px image
- Lightbox displays full 1600px image on click
- Comprehensive tests and manual testing completed

Fixes #56

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"

# Push branch
git push -u origin issue-56

# Create PR
gh pr create --title "Add lightbox viewer to Gallery detail page" --body "$(cat <<'EOF'
## Summary

Implements a lightbox viewer for the Gallery detail page to properly display artwork at appropriate resolutions.

### Changes

- **Created** `ImageLightbox` component (`src/components/ui/ImageLightbox.tsx`)
  - Full-screen overlay with 1600px image display
  - Accessible (keyboard navigation, focus trap, ARIA attributes)
  - Mobile-responsive with native browser pinch-to-zoom
  - Reusable component (will be used on Shoppe page in future PR)

- **Updated** Gallery detail page (`src/app/gallery/[slug]/page.tsx`)
  - Now uses 800px image for main display (instead of 1600px)
  - Added visual affordances: zoom icon overlay on hover + "Click to enlarge" text hint
  - Lightbox opens on image click to show full 1600px image
  - Extracted client component for interactive functionality

- **Maintained** Gallery page implementation (no changes to 300px thumbnails)

### Design Decisions Implemented

- **Visual Affordance:** Both zoom icon overlay (on hover) AND "Click to enlarge" text hint for clear user feedback
- **Mobile Zoom:** Native browser pinch-to-zoom (no custom implementation) for reliability and zero dependencies
- **Navigation:** No previous/next buttons in lightbox to keep scope focused
- **Reusability:** Component placed in `ui/` directory for future reuse on Shoppe page

### Testing

- âœ… All unit tests pass (24 test cases added)
- âœ… TypeScript compiles without errors
- âœ… ESLint passes with zero warnings
- âœ… Prettier formatting applied
- âœ… Manual testing completed (desktop + mobile)
- âœ… Accessibility audit passed (WCAG 2.1 AA)

### Performance

- Reduced initial page load: 800px image (vs 1600px previously)
- 1600px image loads only when lightbox opened
- No layout shift or performance degradation

### Accessibility

- Keyboard navigation: Tab, Shift+Tab, Escape
- Focus trap within lightbox
- Screen reader support with ARIA attributes
- Focus restoration on close

## Test Plan

1. Visit Gallery page â†’ verify 300px thumbnails still work
2. Click artwork â†’ verify 800px image displays on detail page
3. **Visual affordances:** Verify zoom icon appears on hover, "Click to enlarge" text is visible
4. Click 800px image â†’ verify lightbox opens with 1600px image
5. Test close methods: overlay click, close button, Escape key
6. Test keyboard navigation: Tab through focusable elements, Enter to open lightbox
7. **Mobile testing:**
   - Verify responsive layout
   - Verify "Click to enlarge" text visible on mobile
   - Verify native browser pinch-to-zoom works on lightbox image
   - Verify can pan around zoomed image

## Screenshots

(Add screenshots of lightbox in action if needed)

Fixes #56

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
EOF
)"
```

**Expected Outcome:** PR created and ready for review.

**Dependencies:** Step 10 (human review complete)

**Verification:**

```bash
gh pr view --web
```

---

### Step 12: After PR Approval, Squash and Merge

**Action:** Merge PR after approval.

**Process:**

1. Wait for PR approval and CI checks to pass
2. Address any review comments
3. Squash and merge PR via GitHub UI or CLI
4. Delete feature branch

```bash
# After PR is approved
gh pr merge issue-56 --squash --delete-branch
```

**Expected Outcome:** Changes merged to main branch, feature branch deleted.

**Dependencies:** Step 11 (PR created and approved)

**Verification:**

```bash
git checkout main
git pull origin main
git log --oneline -n 5
```

---

## Verification Process

After **EACH** implementation step (Steps 2, 3, 4, 6, 7), follow this verification procedure:

### Verification Commands

```bash
# 1. TypeScript compile check (run as-is, no file paths)
tsc --noEmit

# 2. ESLint (replace {files} with space-separated file paths modified in current step)
npx eslint --fix {files}

# 3. Prettier (replace {files} with space-separated file paths modified in current step)
npx prettier --write {files}

# 4. Vitest (replace {files} with space-separated file paths modified in current step)
npx vitest related run {files}
```

### Verification Steps

1. **Identify modified files:** Note the specific file paths modified in the current step
2. **Run verification commands:** Replace `{files}` with space-separated file paths
3. **Handle failures:**
    - If any command fails, fix the specific error
    - Retry the verification step
    - If failures persist beyond **3 attempts**, STOP implementation
    - Document the issue and ask for human guidance
4. **Proceed only when ALL verifications pass**

### Example (Step 3)

```bash
# Modified files: src/components/ui/ImageLightbox.tsx

tsc --noEmit
npx eslint --fix src/components/ui/ImageLightbox.tsx
npx prettier --write src/components/ui/ImageLightbox.tsx
npx vitest related run src/components/ui/ImageLightbox.tsx
```

---

## Testing Strategy

### TDD Approach

This implementation follows **Test-Driven Development (TDD)** with strict Red-Green-Refactor cycles:

1. **Red Phase:** Write failing tests BEFORE implementation
2. **Green Phase:** Write minimum code to make tests pass
3. **Refactor Phase:** Improve code quality while keeping tests passing

### Test Coverage Goals

- **Unit Tests:** Aim for 90%+ coverage of new components
    - `ImageLightbox` component: all props, interactions, accessibility features
    - `GalleryDetailClient` component: lightbox integration, state management

- **Integration Tests:** Verify Gallery detail page lightbox workflow
    - Open lightbox on image click
    - Close lightbox via overlay, button, Escape key
    - Focus management and accessibility

### Test Data Requirements

- **Mock Artwork Data:**

    ```typescript
    const mockArtwork = {
        id: 'test-id',
        title: 'Test Artwork',
        slug: 'test-artwork',
        description: 'Test description',
        alt_text: 'Test alt text',
        image_thumbnail_url: 'https://example.com/300.jpg',
        image_large_url: 'https://example.com/800.jpg',
        image_url: 'https://example.com/1600.jpg',
        // ... other fields
    };
    ```

- **Test Environment:**
    - Vitest with React Testing Library
    - happy-dom or jsdom for DOM simulation
    - Mock Next.js Image component

### Manual Testing Scenarios

1. **Happy Path:**
    - User visits Gallery page â†’ sees 300px thumbnails
    - User clicks artwork â†’ sees detail page with 800px image
    - User sees "Click to enlarge" text hint below/near image
    - User hovers over 800px image â†’ zoom icon overlay appears
    - User clicks 800px image â†’ lightbox opens with 1600px image
    - User clicks overlay â†’ lightbox closes
    - User navigates back â†’ Gallery page unchanged

2. **Keyboard Navigation:**
    - User presses Tab â†’ focus moves through elements
    - User presses Enter on image â†’ lightbox opens
    - User presses Tab in lightbox â†’ focus trapped within lightbox
    - User presses Escape â†’ lightbox closes, focus restored to image

3. **Mobile Experience:**
    - User views on mobile â†’ images are responsive
    - User sees "Click to enlarge" text hint (zoom icon may not be visible without hover)
    - User taps 800px image â†’ lightbox opens with 1600px image
    - User pinches to zoom â†’ native browser zoom works on lightbox image
    - User pans around zoomed image â†’ browser handles panning
    - User taps overlay â†’ lightbox closes

4. **Edge Cases:**
    - Artwork has no `image_large_url` â†’ falls back gracefully
    - Artwork has no `image_url` â†’ lightbox disabled or shows message
    - Slow network â†’ loading spinner shown while image loads

### Regression Tests

Ensure existing functionality is not broken:

- [ ] Gallery page still displays 300px thumbnails correctly
- [ ] Gallery detail page metadata (title, description, Open Graph) unchanged
- [ ] Gallery detail page layout (title, description, metadata) unchanged
- [ ] Shopping cart functionality unaffected (if artwork is for sale)

---

## Considerations

### Security Implications

- **No security concerns:** Component only displays images from trusted Supabase storage
- **XSS Prevention:** Use Next.js Image component (prevents malicious image URLs)
- **No user input:** Lightbox only receives pre-validated artwork data

### Performance Impacts

- **Positive Impact:** Reduced initial page load (800px vs 1600px image)
- **Lazy Loading:** 1600px image loads only when lightbox opened
- **Image Optimization:** Next.js Image component handles optimization automatically
- **Mobile Optimization:** Responsive images ensure appropriate sizes served

**Performance Metrics to Monitor:**

- Largest Contentful Paint (LCP): Should improve with 800px image
- Cumulative Layout Shift (CLS): Should remain low (no layout shift on lightbox open)
- First Input Delay (FID): Should remain low (lightbox opens quickly)

### Database Migrations

**No database migrations required.** All three image URLs (`image_thumbnail_url`, `image_large_url`, `image_url`) already exist in the schema.

### Backward Compatibility

- **No breaking changes:** Existing Gallery page functionality unchanged
- **Graceful Degradation:** If `image_large_url` is missing, fall back to `image_url`
- **Progressive Enhancement:** Lightbox is an enhancement; core viewing still works without it

### Documentation Updates Needed

1. **CLAUDE.md:** No changes (implementation details only)
2. **README.md:** Optional screenshot or feature mention
3. **Component Documentation:** JSDoc comments for `ImageLightbox` component

### Visual Affordance Accessibility

**Approved Design:** Both zoom icon overlay (on hover) AND "Click to enlarge" text hint

**Accessibility Benefits:**

- **Text hint ("Click to enlarge"):** Always visible, works for keyboard users, screen reader users, and users who don't understand icon
- **Zoom icon overlay:** Visual feedback on hover for mouse users, universally recognized symbol
- **Redundant affordances:** Follows Web Content Accessibility Guidelines (WCAG) principle of providing multiple ways to understand functionality
- **High contrast:** Both elements use high contrast colors for visibility (meets WCAG AA contrast requirements)

**Implementation Considerations:**

- Text hint must be accessible (proper color contrast, sufficient font size)
- Zoom icon should be SVG with `aria-hidden="true"` (decorative, text provides same info)
- Image wrapper should have `role="button"` and `tabindex="0"` for keyboard accessibility
- Image wrapper should have clear focus indicator for keyboard navigation

---

## SOLID Principles Summary

### Single Responsibility Principle (SRP)

- **ImageLightbox:** Handles only lightbox UI/UX (overlay, image display, close behavior)
- **GalleryDetailClient:** Handles only interactive image display and lightbox state
- **Server Component:** Handles only data fetching and metadata generation

### Open/Closed Principle (OCP)

- **ImageLightbox:** Open for extension (can add navigation buttons, zoom controls) without modifying core logic
- **Props Interface:** Can add optional props (e.g., `onPrevious`, `onNext`) without breaking existing usage

### Liskov Substitution Principle (LSP)

- **Component Composition:** ImageLightbox can be used anywhere a dialog/modal is needed
- **Props Contract:** Any component can pass valid `ImageLightboxProps` and expect consistent behavior

### Interface Segregation Principle (ISP)

- **Minimal Props:** ImageLightbox requires only necessary props (`isOpen`, `onClose`, `imageSrc`, `imageAlt`)
- **Optional Props:** Additional props (e.g., `imageTitle`) are optional, not forced on all users

### Dependency Inversion Principle (DIP)

- **Abstract Dependencies:** Components depend on abstract interfaces (`ImageLightboxProps`, `Artwork` type), not concrete implementations
- **Prop Drilling:** Components receive data via props, not direct database access

---

## Acceptance Criteria Verification

| AC # | Requirement                                | Implementation                                | Status |
| ---- | ------------------------------------------ | --------------------------------------------- | ------ |
| 1    | Use 300px image on Gallery page            | No changes to Gallery page                    | âœ…     |
| 2    | Use 800px image on Gallery detail page     | Update to use `image_large_url`               | âœ…     |
| 3    | Allow detail page image to expand to 800px | Remove CSS constraints, display at full 800px | âœ…     |
| 4    | Add lightbox with 1600px image             | Create `ImageLightbox` component              | âœ…     |

---

## Plan Approval Summary

âœ… **Plan Status:** APPROVED - Ready for Implementation

**All design decisions have been finalized:**

1. âœ… **Visual Affordance:** Use both zoom icon overlay (on hover) AND "Click to enlarge" text hint
2. âœ… **Mobile Zoom:** Use native browser pinch-to-zoom (no custom implementation)
3. âœ… **Navigation:** No previous/next buttons in this PR (keep scope focused)
4. âœ… **Component Location:** `src/components/ui/ImageLightbox.tsx` confirmed (will be reused on Shoppe page)

**Next Step:** Begin implementation following TDD workflow (Steps 1-12 as outlined above)

---

## Implementation Notes

- Follow strict TDD Red-Green-Refactor cycles for all code changes
- Run verification commands (tsc, eslint, prettier, vitest) after each step
- If verification fails beyond 3 attempts, stop and request human guidance
- Request human review before creating PR (Step 10)
- Only merge after PR approval and CI checks pass (Step 12)

**Estimated Timeline:** 1-2 days for full implementation, testing, and review

**Ready to proceed with Step 1: Create feature branch `issue-56`**
